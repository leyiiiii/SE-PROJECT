"use strict";(self["webpackChunkMoShu"]=self["webpackChunkMoShu"]||[]).push([[23],{1206:function(t,e,o){o.d(e,{Z:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("el-row",[e("el-col",{attrs:{span:3}},[e("div",{staticClass:"content"},[t.isTeamDoc?e("div",{staticClass:"content-title"},[e("i",{staticClass:"el-icon-s-unfold"}),t._v(" 文档中心 "),e("div",{staticClass:"add-icon",on:{click:t.add}},[t._v("+")])]):e("div",{staticClass:"content-title"},[e("i",{staticClass:"el-icon-s-unfold"}),t._v(" 文档 "),e("div",{staticClass:"add-icon",on:{click:t.add}},[t._v("+")])]),t.isTeamDoc?e("div"):e("div",t._l(t.documentList,(function(o){return e("li",{key:o.id},[e("div",{staticClass:"list-box",on:{click:function(e){return t.openDoc(o.id)}}},[e("i",{staticClass:"el-icon-document"}),t._v(" "+t._s(o.title)+" ")]),e("i",{staticClass:"el-icon-delete",on:{click:function(e){return t.remove(o.id)}}})])})),0)])]),e("el-col",{attrs:{span:18,offset:1}},[t.status?e("div",{staticClass:"doc-title"},[t._v(" "+t._s(t.title)+" "),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改文件名",placement:"top"}},[e("i",{staticClass:"el-icon-edit",on:{click:t.changeTitle}})]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"保存",placement:"top"}},[e("i",{staticClass:"el-icon-upload",on:{click:t.saveDoc}})]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"退出编辑",placement:"top"}},[e("i",{staticClass:"el-icon-check",on:{click:t.endEdit}})])],1):t._e(),t.isOpenADoc?e("Editor"):t._e()],1)],1)},i=[],s=o(3063),l={name:"test",components:{Editor:s.Z},data(){return{isTeamDoc:!1,isOpenADoc:!0,status1:!1,status:!1,iconFormVisible:!1,userInfo:{},dialogTitle:"增加",rowIndex:null,teamId:"",projectId:"",haveDocument:!1,documentId:"",title:"",documentContent:"",createdAt:"",createdBy:"",belongTo:"",updatedAt:"",documentList:[],folderList:[[]]}},created(){if("/team"==this.$route.path.slice(0,5)){this.isTeamDoc=!0;var t=this.$route.params.id.split("&");this.teamId=t[0],this.getTeamDoc(),t.length>2?(this.isOpenADoc=!0,this.documentId=t[2],this.getDocDetail()):this.isOpenADoc=!1}else{t=this.$route.params.id.split("&");this.projectId=t[0],this.getProjDoc(),t.length>2?(this.isOpenADoc=!0,this.documentId=t[2],this.getDocDetail()):this.isOpenADoc=!1}},methods:{endEdit(){},changeTitle(){this.$prompt("更改文档名字","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{let e=new FormData;e.append("title",t),e.append("documentId",this.documentId);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/document/"+this.teamId+"/"+this.documentId,data:e,headers:o}).then((t=>{console.log(t.data)})).catch((t=>{console.log(t)})),this.$message({type:"success",message:"更改成功"}),window.location.reload()})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))},openDoc(t){this.$router.replace("/project/"+this.projectId+"&doc&"+t),window.location.reload()},add(){let t=new FormData;t.append("content",JSON.stringify("<p>this is a document</p>")),t.append("projectId",this.projectId);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/document/create/"+this.projectId,data:t,headers:e}).then((t=>{console.log(t.data),this.openDoc(t.data.id)})).catch((t=>{console.log(t)}))},saveDoc(){let t=new FormData;t.append("title",this.title),t.append("content",JSON.stringify(this.html)),t.append("documentId",this.documentId);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/document/"+this.teamId+"/"+this.documentId,data:t,headers:e}).then((t=>{console.log(t)})).catch((t=>{console.log(t)}))},remove(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/document/"+this.teamId+"/"+t,headers:e}).then((t=>{console.log(t.data),this.$message({type:"success",message:"删除成功!"}),window.location.reload()})).catch((t=>{console.log(t)}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},async getDocDetail(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/project/"+this.projectId,headers:t}).then((t=>{this.teamId=t.data.belongTo})).catch((t=>{console.log(t)})),this.$axios({method:"get",url:"/api/v1/document/"+this.teamId+"/"+this.documentId,headers:t}).then((t=>{console.log(t.data);var e=t.data;this.documentContent=e.content,this.belongTo=e.belongTo,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.createdBy=e.createdBy,this.title=e.title,this.status=!0})).catch((t=>{console.log(t)}))},async getProjDoc(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/document/list?belongTo="+this.projectId,headers:t}).then((t=>{console.log(t.data.results),this.documentList=t.data.results,this.documentList.length>0&&(this.haveDocument=!0)})).catch((t=>{console.log(t)}))},getTeamDoc(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/folder/list?belongTo="+this.teamId,headers:t}).then((e=>{if(console.log(e.data.results),0!=e.data.results.length){var o=[];o=e.data.results,console.log("123456",o);for(let e=0;e<o.length;e++)this.$axios({method:"get",url:"/api/v1/document/list?belongFolder="+o[e].id,headers:t}).then((t=>{console.log("!!!!",t.data)})).catch((t=>{console.log(t)}))}})).catch((t=>{console.log(t)}))}}},n=l,r=o(1001),c=(0,r.Z)(n,a,i,!1,null,"0f580b61",null),d=c.exports},4735:function(t,e,o){o.d(e,{Z:function(){return d}});var a=function(){var t=this,e=t._self._c;return e("el-row",[e("el-container",[e("el-aside",{attrs:{width:"auto"},nativeOn:{mouseenter:function(e){return t.collapseOpen.apply(null,arguments)},mouseleave:function(e){return t.collapseClose.apply(null,arguments)}}},[e("el-menu",{staticClass:"nav-menu",attrs:{router:!0,"unique-opened":!0,collapse:t.isCollapse},on:{open:t.handleOpen,close:t.handleClose}},[e("el-submenu",{attrs:{index:"1"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v(" 用户管理 ")])]),e("el-menu-item-group",[e("el-menu-item",{staticStyle:{cursor:"default"},attrs:{index:""}},[t.profilePic?e("el-avatar",{attrs:{size:25,src:t.profilePic}}):e("el-avatar",{attrs:{size:25,icon:"el-icon-user"}}),e("span",[t._v(" "+t._s(t.username)+" ")])],1),e("el-menu-item",{attrs:{index:""}},[e("i",{staticClass:"el-icon-camera"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 更改头像 ")]),e("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(e){return t.uploadAvatar(e)}}})]),e("el-menu-item",{attrs:{index:""},on:{click:function(e){t.dialogFormVisible=!0}}},[e("i",{staticClass:"el-icon-edit"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 编辑资料 ")])]),e("el-menu-item",{attrs:{index:"/"},on:{click:t.Logout}},[e("i",{staticClass:"el-icon-switch-button"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 退出登录 ")])])],1)],2),e("el-submenu",{attrs:{index:"2"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-office-building"}),e("span",[t._v(" 团队 ")])]),e("el-menu-item-group",t._l(t.joinedTeam,(function(o){return e("el-menu-item",{key:o.index,on:{click:function(e){return t.toTeam(o.id)}}},[t._v(t._s(o.teamName)+" ")])})),1)],2),e("el-menu-item",{attrs:{index:"/invitation"}},[e("i",{staticClass:"el-icon-postcard"}),e("span",{attrs:{slot:"title"},slot:"title"},[t._v(" 查看邀请 ")])]),e("el-menu-item",{attrs:{index:"/about"}},[e("i",{staticClass:"el-icon-collection"}),e("span",{staticClass:"mainTitle"},[t._v(" 关于墨书 ")])])],1)],1),e("el-main")],1),e("el-dialog",{attrs:{title:"编辑个人信息",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{attrs:{model:t.form}},[e("el-form-item",{attrs:{label:"昵称","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),e("el-form-item",{attrs:{label:"真实姓名","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.realname,callback:function(e){t.$set(t.form,"realname",e)},expression:"form.realname"}})],1),e("el-form-item",{attrs:{label:"邮箱","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),e("el-form-item",{attrs:{label:"个性签名","label-width":t.formLabelWidth}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.about,callback:function(e){t.$set(t.form,"about",e)},expression:"form.about"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelEdit}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("确 定")])],1)],1)],1)},i=[],s=o(2094),l={data(){return{isLogin:!1,joinedTeam:[],collapseBtnClick:!1,isCollapse:!0,userId:"",username:"",profilePic:"",form:{username:"",profilePic:"",realname:"",email:"",about:""},dialogFormVisible:!1,formLabelWidth:"120px"}},created(){var t;t=s.Z.getters.getUser(s.Z.state()),t&&(this.isLogin=!0,this.$store.state._isLogin_=!0,this.userId=t.user.id,this.username=t.user.username,this.form.username=t.user.username,this.getUser())},mounted(){this.getJoinedTeam()},methods:{getImg(t){this.form.profilePic=t.target.files[0]},async uploadAvatar(t){this.form.profilePic=t.target.files[0];const e=new FormData;e.append("email",this.form.email),e.append("username",this.form.username),e.append("userId",this.form.id),e.append("about",this.form.about),e.append("realname",this.form.realname),e.append("profile",this.form.profilePic);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/auth/detail/"+this.userId,data:e,headers:o}).then((t=>{console.log(t),this.getUser(),setTimeout((function(){location.reload(!0)}),500),this.$message.success("恭喜！修改成功")})).catch((t=>{console.log(t),this.$message.warning("抱歉！上传失败")}))},async editProfile(){const t=new FormData;t.append("email",this.form.email),t.append("username",this.form.username),t.append("userId",this.form.id),t.append("about",this.form.about),t.append("realname",this.form.realname);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/auth/detail/"+this.userId,data:t,headers:e}).then((t=>{console.log(t),this.getUser(),this.dialogFormVisible=!1,setTimeout((function(){location.reload(!0)}),500),this.$message.success("恭喜！修改成功")})).catch((t=>{console.log(t),this.$message.warning("抱歉！昵称已被使用")}))},cancelEdit(){this.dialogFormVisible=!1,this.getUser()},collapseStatus(){this.collapseBtnClick=this.isCollapse,this.isCollapse=!this.isCollapse},collapseOpen(){this.collapseBtnClick||(this.isCollapse=!1)},collapseClose(){this.collapseBtnClick||(this.isCollapse=!0)},handleOpen(t,e){console.log(t,e)},handleClose(t,e){console.log(t,e)},Logout(){localStorage.removeItem("token"),this.$store.dispatch("clear"),this.$message.success("登出成功"),setTimeout((()=>{this.$router.push({path:"/"}),location.reload()}),500)},async getUser(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/auth/detail/"+this.userId,headers:t}).then((t=>{console.log(t),this.form.realname=t.data.realname,this.form.email=t.data.email,this.profilePic=t.data.thumbnail,this.form.profilePic=t.data.thumbnail})).catch((t=>{console.log(t)}))},async getJoinedTeam(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/team/list",headers:t}).then((t=>{console.log(t),this.joinedTeam=t.data.results})).catch((t=>{console.log(t)}))},toTeam(t){this.$router.push("/team/"+t),setTimeout((()=>{location.reload()}),500)},toInvitation(){this.isLogin?this.$router.push("/invitation"):this.$notify({title:"注意！",message:"请先进行登录",type:"warning"})}}},n=l,r=o(1001),c=(0,r.Z)(n,a,i,!1,null,"89fa0e5a",null),d=c.exports}}]);
//# sourceMappingURL=23.5a71a9c3.js.map