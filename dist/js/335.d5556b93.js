"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[335],{3335:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("el-row",[e("el-col",{attrs:{span:2}},[e("div",{staticClass:"Left"},[e("Navi")],1)]),e("el-col",{attrs:{span:22}},[e("div",{staticClass:"Right"},[e("el-row",[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"info"},[e("span",{staticClass:"teamInfo1"},[t._v(t._s(t.form.name))])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"inviteButton"},[t.isMainAdmin||t.isAdmin?e("el-button",{attrs:{type:"info",round:""},on:{click:function(e){t.dialogVisible2=!0}}},[t._v("邀请成员")]):t._e(),e("el-dialog",{attrs:{title:"邀请成员",visible:t.dialogVisible2,width:"30%","before-close":t.handleClose2},on:{"update:visible":function(e){t.dialogVisible2=e}}},[e("el-form",{attrs:{"label-width":"auto"}},[e("el-form-item",{attrs:{label:"用户名字"}},[e("el-input",{model:{value:t.inviteName,callback:function(e){t.inviteName=e},expression:"inviteName"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelChanges2}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.inviteMember}},[t._v("发送邀请")])],1)],1),e("el-button",{attrs:{type:"danger",round:""},on:{click:t.leaveTeam}},[t._v("离开团队")])],1)])],1),e("el-row",[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"info"},[e("span",{staticClass:"teamInfo2"},[t._v("团队创建日期 : ")]),e("span",{staticClass:"teamInfo2"},[t._v(t._s(t.form.date))])])]),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"info"},[e("span",{staticClass:"teamInfo2"},[t._v("团队人数 : ")]),e("span",{staticClass:"teamInfo2"},[t._v(t._s(t.form.count))])])])],1),e("el-row",[e("el-col",{attrs:{span:2}},[e("div",{staticClass:"infoDesc"},[e("span",{staticClass:"teamInfo2"},[t._v("团队简介 :")])])]),t.hasChinese()?e("el-col",{attrs:{span:20}},[e("div",{staticClass:"infoDesc2"},[e("span",{staticClass:"teamInfo2"},[t._v(t._s(t.form.desc))])])]):e("el-col",{attrs:{span:20}},[e("div",{staticClass:"infoDesc3"},[e("span",{staticClass:"teamInfo2"},[t._v(t._s(t.form.desc))])])])],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"projectTitle"},[e("i",{staticClass:"el-icon-s-order"}),e("span",{staticClass:"membersTitle"},[t._v("项目")]),e("el-button",{staticClass:"addButton",attrs:{icon:"el-icon-plus",circle:""},on:{click:function(e){t.dialogVisible=!0}}}),e("el-dialog",{attrs:{title:"创建项目",visible:t.dialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{attrs:{model:t.project,"label-width":"auto"}},[e("el-form-item",{attrs:{label:"项目名称"}},[e("el-input",{model:{value:t.project.name,callback:function(e){t.$set(t.project,"name",e)},expression:"project.name"}})],1),e("el-form-item",{attrs:{label:"项目简介"}},[e("el-input",{attrs:{type:"textarea",autosize:{minRows:2},autocomplete:"off",resize:"none"},model:{value:t.project.desc,callback:function(e){t.$set(t.project,"desc",e)},expression:"project.desc"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelChanges}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.createProject}},[t._v("确定")])],1)],1)],1)])],1),t.haveProject?e("el-row",t._l(t.projectList,(function(s){return e("el-button",{key:s.id,staticClass:"projectButton",on:{click:function(e){return t.enterProject(s.id)}}},[t._v(t._s(s.title))])})),1):e("el-row",[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"projects"},[t._v(" 暂无项目！ ")])])],1),e("el-row",[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"members"},[e("i",{staticClass:"el-icon-user-solid"}),e("span",{staticClass:"membersTitle"},[t._v("成员列表")])])])],1),e("el-row",{staticClass:"membersRow"},t._l(t.membersList,(function(s){return e("el-row",{key:s.id,attrs:{justify:"center",type:"flex"}},[e("el-col",{attrs:{span:23}},[e("div",{staticClass:"membersList"},[e("el-row",[e("el-col",{attrs:{span:10}},[e("div",{staticClass:"membersInfo"},[e("span",[t._v("昵称: ")]),e("span",[t._v(t._s(s.username))])])]),e("el-col",{attrs:{span:10}},[e("div",{staticClass:"membersInfo"},[e("span",[t._v("真实姓名: ")]),e("span",[t._v(t._s(s.realname))])])]),e("el-col",{attrs:{span:4}},[e("div",{staticClass:"buttonArea"},[t.checkPosition(s.position)?e("el-button",{staticClass:"promoteButton",attrs:{type:"success",round:""},on:{click:t.promoteMember}},[t._v("升为管理员")]):t._e(),t.checkPosition2(s.position)?e("el-button",{staticClass:"kickButton",attrs:{type:"danger",round:""},on:{click:t.kickMember}},[t._v("移除")]):t._e()],1)])],1),e("el-row",[e("el-col",{attrs:{span:10}},[e("div",{staticClass:"membersInfo"},[e("span",[t._v("邮箱: ")]),e("span",[t._v(t._s(s.email))])])]),e("el-col",{attrs:{span:10}},[e("div",{staticClass:"membersInfo"},[e("span",[t._v("身份: ")]),e("span",[t._v(t._s(s.position))])])])],1)],1)])],1)})),1)],1)])],1)},a=[],o=s(7742),l=s(2094),n={name:"Team",components:{Navi:o.Z},created(){var t;t=l.Z.getters.getUser(l.Z.state()),t&&(this.userId=t.user.id)},data(){return{dialogVisible:!1,dialogVisible2:!1,isMainAdmin:!1,isAdmin:!1,isMember:!1,userId:"",form:{name:"",desc:"",date:"",count:""},project:{name:"",desc:""},inviteName:"",haveProject:!1,projectList:[],membersList:[]}},mounted(){this.getTeamInfo(),this.getProjectDetail()},methods:{cancelChanges(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},handleClose(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},cancelChanges2(){this.dialogVisible2=!1,this.inviteName=""},handleClose2(){this.dialogVisible2=!1,this.inviteName=""},createProject(){if(""==this.project.name)return void this.$message.warning("项目名不可为空！");if(""==this.project.desc)return void this.$message.warning("项目简介不可为空！");const t=new FormData;t.append("title",this.project.name),t.append("description",this.project.desc);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/create/"+this.$route.params.id,data:t,headers:e}).then((t=>{console.log(t),this.$message.success("创建项目成功"),setTimeout((function(){location.reload(!0)}),500)})).catch((t=>{console.log(t),this.$message.warning("创建项目失败")})),this.dialogVisible=!1},enterProject(t){this.$router.push("/project/"+t)},inviteMember(){const t=new FormData;t.append("user",this.inviteName),t.append("teamId",this.$route.params.id);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/team/invite",data:t,headers:e}).then((t=>{console.log(t),this.$message.success("邀请成功"),this.dialogVisible2=!1})).catch((t=>{console.log(t),this.$message.warning("抱歉，邀请失败！")}))},leaveTeam(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/leave/"+this.$route.params.id,headers:t}).then((t=>{console.log(t),this.$message.success("离开团队成功"),setTimeout((function(){this.$router.push("/")}),500)})).catch((t=>{console.log(t),this.$message.warning("您是主管理员，无法离开！")}))},async getTeamInfo(){await this.$axios.all([this.getTeamDetail(),this.getTeamMembers()]).then(this.$axios.spread(((t,e)=>{console.log(t),console.log(e),this.form.name=t.data.teamName,this.form.desc=t.data.description,this.form.count=t.data.members,this.form.date=t.data.createdAt.slice(0,10),this.membersList=e.data.results;for(let s=0;s<this.membersList.length;s++)if(this.membersList[s].id===this.userId){if(0==this.membersList[s].position){this.isMainAdmin=!0,console.log("MAIN");break}if(1==this.membersList[s].position){this.isAdmin=!0,console.log("ADMIN");break}if(2==this.membersList[s].position){this.isMember=!0,console.log("NORMAL");break}}for(let s=0;s<this.membersList.length;s++)0==this.membersList[s].position&&(this.membersList[s].position="Main Admin"),1==this.membersList[s].position&&(this.membersList[s].position="Admin"),2==this.membersList[s].position&&(this.membersList[s].position="Member")}))).catch((t=>{console.log(t),this.$router.push({path:"/"})}))},getTeamMembers(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/member/list/"+this.$route.params.id,headers:t})},getTeamDetail(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/"+this.$route.params.id,headers:t})},getProjectDetail(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/project/list?belongTo="+this.$route.params.id,headers:t}).then((t=>{console.log(t),this.projectList=t.data.results,this.projectList.length>0&&(this.haveProject=!0)})).catch((t=>{console.log(t)}))},hasChinese(){const t=/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/,e=this.form.desc.match(t);return e?(console.log("true"),!0):(console.log("false"),!1)},checkPosition(t){return!("Member"!==t||!this.isMainAdmin&&!this.isAdmin)},checkPosition2(t){return!("Member"!==t||!this.isMainAdmin&&!this.isAdmin)||!("Admin"!==t||!this.isMainAdmin)}}},r=n,c=s(3736),m=(0,c.Z)(r,i,a,!1,null,"189cda1e",null),d=m.exports}}]);
//# sourceMappingURL=335.d5556b93.js.map