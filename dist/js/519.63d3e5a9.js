"use strict";(self["webpackChunkMoShu"]=self["webpackChunkMoShu"]||[]).push([[519],{4735:function(e,t,a){a.d(t,{Z:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("el-row",[t("el-container",[t("el-aside",{attrs:{width:"auto"},nativeOn:{mouseenter:function(t){return e.collapseOpen.apply(null,arguments)},mouseleave:function(t){return e.collapseClose.apply(null,arguments)}}},[t("el-menu",{staticClass:"nav-menu",attrs:{router:!0,"unique-opened":!0,collapse:e.isCollapse},on:{open:e.handleOpen,close:e.handleClose}},[t("el-submenu",{attrs:{index:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v(" 用户管理 ")])]),t("el-menu-item-group",[t("el-menu-item",{staticStyle:{cursor:"default"},attrs:{index:""}},[e.profilePic?t("el-avatar",{attrs:{size:25,src:e.profilePic}}):t("el-avatar",{attrs:{size:25,icon:"el-icon-user"}}),t("span",[e._v(" "+e._s(e.username)+" ")])],1),t("el-menu-item",{attrs:{index:""}},[t("i",{staticClass:"el-icon-camera"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(" 更改头像 ")]),t("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(t){return e.uploadAvatar(t)}}})]),t("el-menu-item",{attrs:{index:""},on:{click:function(t){e.dialogFormVisible=!0}}},[t("i",{staticClass:"el-icon-edit"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(" 编辑资料 ")])]),t("el-menu-item",{attrs:{index:"/"},on:{click:e.Logout}},[t("i",{staticClass:"el-icon-switch-button"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(" 退出登录 ")])])],1)],2),t("el-submenu",{attrs:{index:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-office-building"}),t("span",[e._v(" 团队 ")])]),t("el-menu-item-group",e._l(e.joinedTeam,(function(a){return t("el-menu-item",{key:a.index,on:{click:function(t){return e.toTeam(a.id)}}},[e._v(e._s(a.teamName)+" ")])})),1)],2),t("el-menu-item",{attrs:{index:"/invitation"}},[t("i",{staticClass:"el-icon-postcard"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v(" 查看邀请 ")])]),t("el-menu-item",{attrs:{index:"/about"}},[t("i",{staticClass:"el-icon-collection"}),t("span",{staticClass:"mainTitle"},[e._v(" 关于墨书 ")])])],1)],1),t("el-main")],1),t("el-dialog",{attrs:{title:"编辑个人信息",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"昵称","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"真实姓名","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.realname,callback:function(t){e.$set(e.form,"realname",t)},expression:"form.realname"}})],1),t("el-form-item",{attrs:{label:"邮箱","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{label:"个性签名","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.about,callback:function(t){e.$set(e.form,"about",t)},expression:"form.about"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelEdit}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("确 定")])],1)],1)],1)},i=[],o=a(2094),l={data(){return{isLogin:!1,joinedTeam:[],collapseBtnClick:!1,isCollapse:!0,userId:"",username:"",profilePic:"",form:{username:"",profilePic:"",realname:"",email:"",about:""},dialogFormVisible:!1,formLabelWidth:"120px"}},created(){var e;e=o.Z.getters.getUser(o.Z.state()),e&&(this.isLogin=!0,this.$store.state._isLogin_=!0,this.userId=e.user.id,this.username=e.user.username,this.form.username=e.user.username,this.getUser())},mounted(){this.getJoinedTeam()},methods:{getImg(e){this.form.profilePic=e.target.files[0]},async uploadAvatar(e){this.form.profilePic=e.target.files[0];const t=new FormData;t.append("email",this.form.email),t.append("username",this.form.username),t.append("userId",this.form.id),t.append("about",this.form.about),t.append("realname",this.form.realname),t.append("profile",this.form.profilePic);var a={};localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/auth/detail/"+this.userId,data:t,headers:a}).then((e=>{console.log(e),this.getUser(),setTimeout((function(){location.reload(!0)}),500),this.$message.success("恭喜！修改成功")})).catch((e=>{console.log(e),this.$message.warning("抱歉！上传失败")}))},async editProfile(){const e=new FormData;e.append("email",this.form.email),e.append("username",this.form.username),e.append("userId",this.form.id),e.append("about",this.form.about),e.append("realname",this.form.realname);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/auth/detail/"+this.userId,data:e,headers:t}).then((e=>{console.log(e),this.getUser(),this.dialogFormVisible=!1,setTimeout((function(){location.reload(!0)}),500),this.$message.success("恭喜！修改成功")})).catch((e=>{console.log(e),this.$message.warning("抱歉！昵称已被使用")}))},cancelEdit(){this.dialogFormVisible=!1,this.getUser()},collapseStatus(){this.collapseBtnClick=this.isCollapse,this.isCollapse=!this.isCollapse},collapseOpen(){this.collapseBtnClick||(this.isCollapse=!1)},collapseClose(){this.collapseBtnClick||(this.isCollapse=!0)},handleOpen(e,t){console.log(e,t)},handleClose(e,t){console.log(e,t)},Logout(){localStorage.removeItem("token"),this.$store.dispatch("clear"),this.$message.success("登出成功"),setTimeout((()=>{this.$router.push({path:"/"}),location.reload()}),500)},async getUser(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/auth/detail/"+this.userId,headers:e}).then((e=>{console.log(e),this.form.realname=e.data.realname,this.form.email=e.data.email,this.profilePic=e.data.thumbnail,this.form.profilePic=e.data.thumbnail})).catch((e=>{console.log(e)}))},async getJoinedTeam(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/team/list",headers:e}).then((e=>{console.log(e),this.joinedTeam=e.data.results})).catch((e=>{console.log(e)}))},toTeam(e){this.$router.push("/team/"+e),setTimeout((()=>{location.reload()}),500)},toInvitation(){this.isLogin?this.$router.push("/invitation"):this.$notify({title:"注意！",message:"请先进行登录",type:"warning"})}}},n=l,r=a(1001),c=(0,r.Z)(n,s,i,!1,null,"89fa0e5a",null),m=c.exports},8519:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("el-row",{staticClass:"main",attrs:{type:"flex",justify:"center"}},[t("el-col",{attrs:{span:20}},[t("div",{staticClass:"wrapper"},[t("div",{staticClass:"pic-wrapper"},[t("img",{attrs:{id:"bg",src:a(1915)}})]),t("div",{staticClass:"login-wrapper"},[t("el-row",{attrs:{justify:"center",type:"flex"}},[t("img",{attrs:{id:"logo",src:a(2533),alt:"logo"}})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"input-name",attrs:{type:"text",placeholder:"用户名"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),t("i",{staticClass:"el-icon-view hidden"})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.realname,expression:"realname"}],staticClass:"input-name",attrs:{type:"text",placeholder:"真实姓名"},domProps:{value:e.realname},on:{input:function(t){t.target.composing||(e.realname=t.target.value)}}}),t("i",{staticClass:"el-icon-view hidden"})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"input-name",attrs:{type:"text",placeholder:"邮箱"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),t("i",{staticClass:"el-icon-view hidden"})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[e.canSee1?t("input",{directives:[{name:"model",rawName:"v-model",value:e.password1,expression:"password1"}],staticClass:"input-pwd",attrs:{type:"text",placeholder:"密码"},domProps:{value:e.password1},on:{input:function(t){t.target.composing||(e.password1=t.target.value)}}}):t("input",{directives:[{name:"model",rawName:"v-model",value:e.password1,expression:"password1"}],staticClass:"input-pwd",attrs:{type:"password",placeholder:"密码"},domProps:{value:e.password1},on:{input:function(t){t.target.composing||(e.password1=t.target.value)}}}),t("i",{staticClass:"el-icon-view",on:{click:e.changeSee1}})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[e.canSee2?t("input",{directives:[{name:"model",rawName:"v-model",value:e.password2,expression:"password2"}],staticClass:"input-pwd",attrs:{type:"text",placeholder:"重复密码"},domProps:{value:e.password2},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.Register.apply(null,arguments)},input:function(t){t.target.composing||(e.password2=t.target.value)}}}):t("input",{directives:[{name:"model",rawName:"v-model",value:e.password2,expression:"password2"}],staticClass:"input-pwd",attrs:{type:"password",placeholder:"重复密码"},domProps:{value:e.password2},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.Register.apply(null,arguments)},input:function(t){t.target.composing||(e.password2=t.target.value)}}}),t("i",{staticClass:"el-icon-view",on:{click:e.changeSee2}})]),t("el-row",{attrs:{justify:"center",type:"flex"}},[t("div",{staticStyle:{width:"350px","text-align":"end"}},[t("span",[e._v("已有帐号，")]),t("button",{staticClass:"login-button",on:{click:e.gotoLogin}},[e._v(" 立即登录 ")])])]),t("el-row",{attrs:{justify:"center",type:"flex"}},[t("button",{staticClass:"regist-button",on:{click:e.Register}},[e._v("注册")])])],1)])])],1)},i=[],o=a(4735),l={name:"Register",components:{Navi:o.Z},data(){return{username:"",realname:"",email:"",password1:"",password2:"",canSee1:!1,canSee2:!1}},methods:{changeSee1(){this.canSee1=!this.canSee1},changeSee2(){this.canSee2=!this.canSee2},gotoLogin(){this.$router.push("/login")},Register(){if(""==this.username||""==this.realname||""==this.email||""==this.password1||""==this.password2)return void this.$message.warning("请填写所有空格!");const e=new FormData;e.append("username",this.username),e.append("realname",this.realname),e.append("email",this.email),e.append("password",this.password1),e.append("password2",this.password2),this.$axios({method:"post",url:"/api/v1/auth/register/",data:e}).then((e=>{switch(console.log(e),e.status){case 201:this.$message.success("注册成功"),this.$router.push("/login");break}})).catch((e=>{switch(console.log(e.response.data.code),e.response.data.code){case 1001:this.$message.warning("邮箱已被使用");break;case 1002:this.$message.warning("用户名已被使用");break;case 1003:this.$message.warning("密码与重复密码不匹配");break;case 1004:this.$message.warning("密码需包含字母、数字及符号且字符数>=8");break;default:this.$message.warning("填写信息错误")}}))}}},n=l,r=a(1001),c=(0,r.Z)(n,s,i,!1,null,"0047e20a",null),m=c.exports},1915:function(e,t,a){e.exports=a.p+"img/RegistBg.31afb894.png"}}]);
//# sourceMappingURL=519.63d3e5a9.js.map