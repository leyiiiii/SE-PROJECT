"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[544],{3544:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("el-row",[t("el-col",{attrs:{span:2}},[t("div",{staticClass:"Left"},[t("Navi")],1)]),t("el-col",{attrs:{span:22}},[t("div",{staticClass:"Right"},[t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"info"},[t("span",{staticClass:"teamInfo1"},[e._v(e._s(e.form.name))])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"inviteButton"},[e.isMainAdmin||e.isAdmin?t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.dialogVisible2=!0}}},[e._v("邀请成员")]):e._e(),t("el-dialog",{attrs:{title:"邀请成员",visible:e.dialogVisible2,width:"30%","before-close":e.handleClose2},on:{"update:visible":function(t){e.dialogVisible2=t}}},[t("el-form",{attrs:{"label-width":"auto"}},[t("el-form-item",{attrs:{label:"用户名字"}},[t("el-input",{model:{value:e.inviteName,callback:function(t){e.inviteName=t},expression:"inviteName"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges2}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.inviteMember}},[e._v("发送邀请")])],1)],1),t("el-button",{attrs:{type:"danger",round:""},on:{click:e.leaveTeam}},[e._v("离开团队")])],1)])],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"info"},[t("span",{staticClass:"teamInfo2"},[e._v("团队创建日期 : ")]),t("span",{staticClass:"teamInfo2"},[e._v(e._s(e.form.date))])])]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"info"},[t("span",{staticClass:"teamInfo2"},[e._v("团队人数 : ")]),t("span",{staticClass:"teamInfo2"},[e._v(e._s(e.form.count))])])])],1),t("el-row",[t("el-col",{attrs:{span:2}},[t("div",{staticClass:"infoDesc"},[t("span",{staticClass:"teamInfo2"},[e._v("团队简介 :")])])]),e.hasChinese()?t("el-col",{attrs:{span:20}},[t("div",{staticClass:"infoDesc2"},[t("span",{staticClass:"teamInfo2"},[e._v(e._s(e.form.desc))])])]):t("el-col",{attrs:{span:20}},[t("div",{staticClass:"infoDesc3"},[t("span",{staticClass:"teamInfo2"},[e._v(e._s(e.form.desc))])])])],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projectTitle"},[t("i",{staticClass:"el-icon-s-order"}),t("span",{staticClass:"membersTitle"},[e._v("项目")]),t("el-button",{staticClass:"addButton",attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){e.dialogVisible=!0}}}),t("el-dialog",{attrs:{title:"创建项目",visible:e.dialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.project,"label-width":"auto"}},[t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{model:{value:e.project.name,callback:function(t){e.$set(e.project,"name",t)},expression:"project.name"}})],1),t("el-form-item",{attrs:{label:"项目简介"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},autocomplete:"off",resize:"none"},model:{value:e.project.desc,callback:function(t){e.$set(e.project,"desc",t)},expression:"project.desc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.createProject}},[e._v("确定")])],1)],1)],1)])],1),e.haveProject?t("el-row",e._l(e.projectList,(function(s){return t("el-button",{key:s.id,staticClass:"projectButton",on:{click:function(t){return e.enterProject(s.id)}}},[e._v(e._s(s.title))])})),1):t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projects"},[e._v(" 暂无项目！ ")])])],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"members"},[t("i",{staticClass:"el-icon-user-solid"}),t("span",{staticClass:"membersTitle"},[e._v("成员列表")])])])],1),t("el-row",{staticClass:"membersRow"},e._l(e.membersList,(function(s){return t("el-row",{key:s.id,attrs:{justify:"center",type:"flex"}},[t("el-col",{attrs:{span:23}},[t("div",{staticClass:"membersList"},[t("el-row",[t("el-col",{attrs:{span:10}},[t("div",{staticClass:"membersInfo"},[t("span",[e._v("昵称: ")]),t("span",[e._v(e._s(s.username))])])]),t("el-col",{attrs:{span:10}},[t("div",{staticClass:"membersInfo"},[t("span",[e._v("真实姓名: ")]),t("span",[e._v(e._s(s.realname))])])]),t("el-col",{attrs:{span:4}},[t("div",{staticClass:"buttonArea"},[e.checkPosition(s.position)?t("el-button",{staticClass:"promoteButton",attrs:{type:"success",round:""},on:{click:function(t){return e.promoteMember(s.id)}}},[e._v("升为管理员")]):e._e(),e.checkPosition3(s.position)?t("el-button",{staticClass:"promoteButton",attrs:{type:"danger",round:""},on:{click:function(t){return e.demoteMember(s.id)}}},[e._v("降为成员")]):e._e(),e.checkPosition2(s.position)?t("el-button",{staticClass:"kickButton",attrs:{type:"danger",round:""},on:{click:function(t){return e.kickMember(s.id)}}},[e._v("移除")]):e._e()],1)])],1),t("el-row",[t("el-col",{attrs:{span:10}},[t("div",{staticClass:"membersInfo"},[t("span",[e._v("邮箱: ")]),t("span",[e._v(e._s(s.email))])])]),t("el-col",{attrs:{span:10}},[t("div",{staticClass:"membersInfo"},[t("span",[e._v("身份: ")]),t("span",[e._v(e._s(s.position))])])])],1)],1)])],1)})),1)],1)])],1)},o=[],a=s(9899),r=s(2094),n={name:"Team",components:{Navi:a.Z},created(){var e;e=r.Z.getters.getUser(r.Z.state()),e&&(this.userId=e.user.id)},data(){return{dialogVisible:!1,dialogVisible2:!1,isMainAdmin:!1,isAdmin:!1,isMember:!1,userId:"",form:{name:"",desc:"",date:"",count:""},project:{name:"",desc:""},inviteName:"",haveProject:!1,projectList:[],membersList:[]}},mounted(){this.getTeamInfo(),this.getProjectDetail()},methods:{cancelChanges(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},handleClose(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},cancelChanges2(){this.dialogVisible2=!1,this.inviteName=""},handleClose2(){this.dialogVisible2=!1,this.inviteName=""},createProject(){if(""==this.project.name)return void this.$message.warning("项目名不可为空！");if(""==this.project.desc)return void this.$message.warning("项目简介不可为空！");const e=new FormData;e.append("title",this.project.name),e.append("description",this.project.desc);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/create/"+this.$route.params.id,data:e,headers:t}).then((e=>{console.log(e),this.$message.success("创建项目成功"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("创建项目失败")})),this.dialogVisible=!1},enterProject(e){this.$router.push("/project/"+e)},inviteMember(){const e=new FormData;e.append("user",this.inviteName),e.append("teamId",this.$route.params.id);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/team/invite",data:e,headers:t}).then((e=>{console.log(e),this.$message.success("邀请成功"),this.dialogVisible2=!1})).catch((e=>{console.log(e),this.$message.warning("抱歉，邀请失败！")}))},leaveTeam(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/leave/"+this.$route.params.id,headers:e}).then((e=>{console.log(e),this.$message.success("离开团队成功"),this.$router.push({path:"/"})})).catch((e=>{console.log(e),this.$message.warning("您是主管理员，无法离开！")}))},async getTeamInfo(){await this.$axios.all([this.getTeamDetail(),this.getTeamMembers()]).then(this.$axios.spread(((e,t)=>{console.log(e),console.log(t),this.form.name=e.data.teamName,this.form.desc=e.data.description,this.form.count=e.data.members,this.form.date=e.data.createdAt.slice(0,10),this.membersList=t.data.results;for(let s=0;s<this.membersList.length;s++)if(this.membersList[s].id===this.userId){if(0==this.membersList[s].position){this.isMainAdmin=!0,console.log("MAIN");break}if(1==this.membersList[s].position){this.isAdmin=!0,console.log("ADMIN");break}if(2==this.membersList[s].position){this.isMember=!0,console.log("NORMAL");break}}for(let s=0;s<this.membersList.length;s++)0==this.membersList[s].position&&(this.membersList[s].position="Main Admin"),1==this.membersList[s].position&&(this.membersList[s].position="Admin"),2==this.membersList[s].position&&(this.membersList[s].position="Member")}))).catch((e=>{console.log(e),this.$router.push({path:"/"})}))},getTeamMembers(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/member/list/"+this.$route.params.id,headers:e})},getTeamDetail(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/"+this.$route.params.id,headers:e})},getProjectDetail(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/project/list?belongTo="+this.$route.params.id,headers:e}).then((e=>{console.log(e),this.projectList=e.data.results,this.projectList.length>0&&(this.haveProject=!0)})).catch((e=>{console.log(e)}))},hasChinese(){const e=/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/,t=this.form.desc.match(e);return t?(console.log("true"),!0):(console.log("false"),!1)},checkPosition(e){return!("Member"!==e||!this.isMainAdmin&&!this.isAdmin)},checkPosition2(e){return!("Member"!==e||!this.isMainAdmin&&!this.isAdmin)||!("Admin"!==e||!this.isMainAdmin)},checkPosition3(e){return!(!this.isMainAdmin||"Admin"!==e)},promoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/set/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},demoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/remove/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},kickMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/member/remove/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("移除成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))}}},l=n,c=s(3736),m=(0,c.Z)(l,i,o,!1,null,"578269fe",null),h=m.exports}}]);
//# sourceMappingURL=544.3c207d8d.js.map