"use strict";(self["webpackChunkMoShu"]=self["webpackChunkMoShu"]||[]).push([[694],{33672:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});i(26699);var o=function(){var e=this,t=e._self._c;return t("el-row",[t("el-col",{attrs:{span:2}},[t("div",{staticClass:"Nav"},[t("Navi")],1)]),t("el-col",{attrs:{span:21}},[t("div",{staticClass:"Right"},[t("el-row",[t("el-col",{attrs:{span:19}},[t("div",{staticClass:"info"},[t("span",{staticClass:"teamInfo1"},[e._v(e._s(e.form.name))])])]),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"inviteButton"},[e.isMainAdmin||e.isAdmin?t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.dialogVisible2=!0}}},[e._v("邀请成员")]):e._e(),t("el-dialog",{attrs:{title:"邀请成员",visible:e.dialogVisible2,width:"30%","before-close":e.handleClose2},on:{"update:visible":function(t){e.dialogVisible2=t}}},[t("el-form",{attrs:{"label-width":"auto"}},[t("el-form-item",{attrs:{label:"用户名字"}},[t("el-input",{model:{value:e.inviteName,callback:function(t){e.inviteName=t},expression:"inviteName"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges2}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.inviteMember}},[e._v("发送邀请")])],1)],1),t("el-button",{attrs:{type:"danger",round:""},on:{click:e.leaveTeam}},[e._v("离开团队")])],1)])],1),t("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.activeIndex,mode:"horizontal","background-color":"#F4E3E0","active-text-color":"#ff6699","text-color":"black"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"1"}},[e._v("详情")]),t("el-menu-item",{attrs:{index:"2"}},[e._v("项目")]),t("el-menu-item",{attrs:{index:"3"}},[e._v("文档中心")]),t("el-menu-item",{attrs:{index:"4"}},[e._v("成员列表")])],1),1==e.activePage?t("el-row",[t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:i(36090)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("创建日期")]),t("p",[e._v(" "+e._s(e.form.date))])])])]),t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:i(31744)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("人数")]),t("p",[e._v(" "+e._s(e.form.count))])])])]),t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:i(27314)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("简介")]),t("p",[e._v(" "+e._s(e.form.desc))])])])])]):e._e(),2==e.activePage?t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projectTitle"},[t("i",{staticClass:"el-icon-s-order"}),t("span",{staticClass:"membersTitle"},[e._v("项目")]),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"创建项目",placement:"top-start"}},[t("el-button",{staticClass:"addButton",attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){e.dialogVisible=!0}}})],1),t("el-dialog",{attrs:{title:"创建项目",visible:e.dialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.project,"label-width":"auto"}},[t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{model:{value:e.project.name,callback:function(t){e.$set(e.project,"name",t)},expression:"project.name"}})],1),t("el-form-item",{attrs:{label:"项目简介"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},autocomplete:"off",resize:"none"},model:{value:e.project.desc,callback:function(t){e.$set(e.project,"desc",t)},expression:"project.desc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.createProject}},[e._v("确定")])],1)],1),t("el-button",{staticClass:"recycleButton",attrs:{icon:"el-icon-delete-solid",round:""},on:{click:e.toRecycle}},[e._v("回收站")]),e.haveProject&&2==e.activePage?t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.projectList.filter((t=>!e.search||t.title.toLowerCase().includes(e.search.toLowerCase())||t.creatorName.toLowerCase().includes(e.search.toLowerCase()))),"cell-class-name":e.getCellIndex},on:{"cell-click":e.toProject}},[t("el-table-column",{attrs:{label:"项目名字",prop:"title",sortable:""}}),t("el-table-column",{attrs:{label:"创建日期",prop:"createdAt",sortable:""}}),t("el-table-column",{attrs:{label:"创建者",prop:"creatorName"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.editProject_(i.$index,i.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-document-copy",circle:""},on:{click:function(t){return e.duplicateProject(i.$index,i.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteProject(i.$index,i.row)}}})],1),t("el-dialog",{attrs:{title:"编辑项目",visible:e.editDialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{attrs:{model:e.form,"label-width":"auto"}},[t("el-form-item",{attrs:{label:"项目名字"}},[t("el-input",{model:{value:e.form.nameTemp,callback:function(t){e.$set(e.form,"nameTemp",t)},expression:"form.nameTemp"}})],1),t("el-form-item",{attrs:{label:"项目简介"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},autocomplete:"off",resize:"none"},model:{value:e.form.descTemp,callback:function(t){e.$set(e.form,"descTemp",t)},expression:"form.descTemp"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelEditProject}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.editProject()}}},[e._v("确定")])],1)],1)]}}],null,!1,1573735902)},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入您的搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],2)],1):e._e()],1)])],1):e._e(),e.haveProject||2!=e.activePage?e._e():t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projects"},[e._v(" 暂无项目！ ")])])],1),3==e.activePage?t("el-row",[t("Doc")],1):e._e(),4==e.activePage?t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"membersRow"},e._l(e.membersList,(function(i){return t("el-descriptions",{key:i.id,staticClass:"description",attrs:{border:"",column:5}},[t("el-descriptions-item",{attrs:{label:"昵称","label-class-name":e.my-e.label,contentStyle:e.contentStyle,labelStyle:e.labelStyle}},[e._v(e._s(i.username)+" ")]),""==i.realname?t("el-descriptions-item",{attrs:{label:"真实姓名",contentStyle:e.contentStyle,labelStyle:e.labelStyle2}},[e._v(e._s(i.username)+" ")]):t("el-descriptions-item",{attrs:{label:"真实姓名",contentStyle:e.contentStyle,labelStyle:e.labelStyle2}},[e._v(" "+e._s(i.realname)+" ")]),t("el-descriptions-item",{attrs:{label:"邮箱",contentStyle:e.contentStyle2,labelStyle:e.labelStyle}},[e._v(" "+e._s(i.email)+" ")]),t("el-descriptions-item",{attrs:{label:"身份",labelStyle:e.labelStyle}},["Main Admin"==i.position?t("el-tag",{attrs:{size:"small",type:"warning"}},[e._v("主管理员")]):e._e(),"Admin"==i.position?t("el-tag",{attrs:{size:"small"}},[e._v("管理员")]):e._e(),"Member"==i.position?t("el-tag",{attrs:{size:"small",type:"info"}},[e._v("成员")]):e._e(),t("el-dropdown",{staticClass:"More",attrs:{trigger:"click"}},[e.checkPosition4(i.position,i.id)?t("i",{staticClass:"el-icon-more"}):e._e(),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.checkPosition(i.position)?t("el-dropdown-item",{nativeOn:{click:function(t){return e.promoteMember(i.id)}}},[e._v(" 升为管理员 ")]):e._e(),e.checkPosition3(i.position)?t("el-dropdown-item",{nativeOn:{click:function(t){return e.demoteMember(i.id)}}},[e._v(" 降为成员 ")]):e._e(),e.checkPosition2(i.position)?t("el-dropdown-item",{nativeOn:{click:function(t){return e.kickMember(i.id)}}},[e._v("移除 ")]):e._e()],1)],1)],1)],1)})),1)])],1):e._e()],1)])],1)},s=[],a=i(29856),l=i(11389),n=i(92094),r={name:"Team",components:{Navi:a.Z,Doc:l.Z},data(){return{haveTeam:!1,dialogVisible:!1,dialogVisible2:!1,isMainAdmin:!1,isAdmin:!1,isMember:!1,userId:"",activeIndex:"1",activePage:1,form:{name:"",desc:"",date:"",count:"",nameTemp:"",descTemp:"",belongTo:""},project:{name:"",desc:""},indexTemp:0,rowTemp:{},inviteName:"",haveProject:!1,projectList:[],membersList:[],search:"",rowIndex:0,cellIndex:0,contentStyle:{width:"250px"},contentStyle2:{width:"400px"},labelStyle:{width:"55px"},labelStyle2:{width:"90px"},editDialogVisible:!1}},created(){var e,t=this.$route.params.id.split("&");this.teamId=t[0],t.length>1&&(this.activePage=3),this.getTeamInfo(),this.getProjectDetail(),e=n.Z.getters.getUser(n.Z.state()),e&&(this.userId=e.user.id)},methods:{duplicateProject(e,t){var i={};localStorage.getItem("token")&&(i={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/copy/"+t.id,headers:i}).then((e=>{console.log(e),this.$message.success("项目复制成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("项目复制失败！")}))},deleteProject(e,t){var i={};localStorage.getItem("token")&&(i={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/project/"+t.id,headers:i}).then((t=>{console.log(t),this.$message.success("项目删除成功！"),this.projectList.splice(e,1)})).catch((e=>{console.log(e),this.$message.warning("项目删除失败！")}))},cancelEditProject(){this.editDialogVisible=!1,this.form.nameTemp=this.form.name,this.form.descTemp=this.form.desc},editProject_(e,t){this.editDialogVisible=!0,this.indexTemp=e,this.rowTemp=t},editProject(){const e=new FormData;e.append("title",this.form.nameTemp),e.append("description",this.form.descTemp);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/project/"+this.rowTemp.id,data:e,headers:t}).then((e=>{console.log(e),this.$message.success("项目编辑成功"),this.editDialogVisible=!1,this.form.name=this.form.nameTemp,this.form.desc=this.form.descTemp,setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("项目编辑失败！")}))},cancelChanges(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},handleClose(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},cancelChanges2(){this.dialogVisible2=!1,this.inviteName=""},handleClose2(){this.dialogVisible2=!1,this.inviteName=""},handleSelect(e,t){"1"==e&&(this.activePage=1),"2"==e&&(this.activePage=2),"3"==e&&(this.activePage=3),"4"==e&&(this.activePage=4)},createProject(){if(""==this.project.name)return void this.$message.warning("项目名不可为空！");if(""==this.project.desc)return void this.$message.warning("项目简介不可为空！");const e=new FormData;e.append("title",this.project.name),e.append("description",this.project.desc);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/create/"+this.teamId,data:e,headers:t}).then((e=>{console.log(e),this.$message.success("创建项目成功"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("创建项目失败")})),this.dialogVisible=!1},enterProject(e){this.$router.push("/project/"+e)},getCellIndex({row:e,column:t,rowIndex:i,columnIndex:o}){e.index=i,t.index=o},toProject(e,t,i,o){this.rowIndex=e.index,this.columnIndex=t.index,3!=this.columnIndex&&this.$router.push("/project/"+e.id)},inviteMember(){const e=new FormData;e.append("user",this.inviteName),e.append("teamId",this.teamId);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/team/invite",data:e,headers:t}).then((e=>{console.log(e),this.$message.success("邀请成功"),this.dialogVisible2=!1})).catch((e=>{console.log(e),this.$message.warning("抱歉，邀请失败！")}))},leaveTeam(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/leave/"+this.teamId,headers:e}).then((e=>{console.log(e),this.$message.success("离开团队成功"),this.$router.push({path:"/teamhome"})})).catch((e=>{console.log(e),this.$message.warning("您是主管理员，无法离开！")}))},async getTeamInfo(){await this.$axios.all([this.getTeamDetail(),this.getTeamMembers()]).then(this.$axios.spread(((e,t)=>{console.log(e),console.log(t),this.form.name=e.data.teamName,this.form.desc=e.data.description,this.form.count=e.data.members,this.form.date=e.data.createdAt.slice(0,10),this.membersList=t.data.results;for(let i=0;i<this.membersList.length;i++)if(this.membersList[i].id===this.userId){if(0==this.membersList[i].position){this.isMainAdmin=!0,console.log("MAIN");break}if(1==this.membersList[i].position){this.isAdmin=!0,console.log("ADMIN");break}if(2==this.membersList[i].position){this.isMember=!0,console.log("NORMAL");break}}for(let i=0;i<this.membersList.length;i++)0==this.membersList[i].position&&(this.membersList[i].position="Main Admin"),1==this.membersList[i].position&&(this.membersList[i].position="Admin"),2==this.membersList[i].position&&(this.membersList[i].position="Member")}))).catch((e=>{console.log(e),this.$router.push({path:"/"})}))},getTeamMembers(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/member/list/"+this.teamId,headers:e})},getTeamDetail(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/"+this.teamId,headers:e})},getProjectDetail(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/project/list?belongTo="+this.teamId,headers:e}).then((e=>{console.log(e),this.projectList=e.data.results;for(let t=0;t<this.projectList.length;t++)this.projectList[t].createdAt=this.projectList[t].createdAt.slice(0,10);this.projectList.length>0&&(this.haveProject=!0)})).catch((e=>{console.log(e)}))},hasChinese(){const e=/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/,t=this.form.desc.match(e);return!!t},checkPosition(e){return!("Member"!==e||!this.isMainAdmin&&!this.isAdmin)&&(console.log("CAN PROMOTE"),!0)},checkPosition2(e){return"Member"===e&&(this.isMainAdmin||this.isAdmin)?(console.log("CAN DEMOTE"),!0):!("Admin"!==e||!this.isMainAdmin)&&(console.log("CAN KICK"),!0)},checkPosition3(e){return!(!this.isMainAdmin||"Admin"!==e)&&(console.log("CAN DEMOTE"),!0)},checkPosition4(e,t){return t!=this.userId&&(!!this.isMainAdmin||!(!this.isAdmin||"Member"!=e))},promoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/set/"+this.teamId+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},demoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/remove/"+this.teamId+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},kickMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/member/remove/"+this.teamId+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("移除成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},toRecycle(){this.$router.push("/recycle/"+this.teamId)}}},c=r,m=i(1001),d=(0,m.Z)(c,o,s,!1,null,"3fdcbe82",null),h=d.exports},36090:function(e,t,i){e.exports=i.p+"img/Group1.92a5a959.png"},31744:function(e,t,i){e.exports=i.p+"img/Group2.d3fdbfc4.png"},27314:function(e,t,i){e.exports=i.p+"img/Group3.f60b8a60.png"}}]);
//# sourceMappingURL=694.f765c82a.js.map