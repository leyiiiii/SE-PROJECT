"use strict";(self["webpackChunkMoShu"]=self["webpackChunkMoShu"]||[]).push([[767],{6122:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});s(6699);var i=function(){var e=this,t=e._self._c;return t("el-row",[t("el-col",{attrs:{span:2}},[t("div",{staticClass:"Nav"},[t("Navi")],1)]),t("el-col",{attrs:{span:21}},[t("div",{staticClass:"Right"},[t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"info"},[t("span",{staticClass:"teamInfo1"},[e._v(e._s(e.form.name))])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"inviteButton"},[e.isMainAdmin||e.isAdmin?t("el-button",{attrs:{type:"info",round:""},on:{click:function(t){e.dialogVisible2=!0}}},[e._v("邀请成员")]):e._e(),t("el-dialog",{attrs:{title:"邀请成员",visible:e.dialogVisible2,width:"30%","before-close":e.handleClose2},on:{"update:visible":function(t){e.dialogVisible2=t}}},[t("el-form",{attrs:{"label-width":"auto"}},[t("el-form-item",{attrs:{label:"用户名字"}},[t("el-input",{model:{value:e.inviteName,callback:function(t){e.inviteName=t},expression:"inviteName"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges2}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.inviteMember}},[e._v("发送邀请")])],1)],1),t("el-button",{attrs:{type:"danger",round:""},on:{click:e.leaveTeam}},[e._v("离开团队")])],1)])],1),t("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.activeIndex,mode:"horizontal","background-color":"#F4E3E0","active-text-color":"#ff6699","text-color":"black"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"1"}},[e._v("详情")]),t("el-menu-item",{attrs:{index:"2"}},[e._v("项目")]),t("el-menu-item",{attrs:{index:"3"}},[e._v("文档中心")]),t("el-menu-item",{attrs:{index:"4"}},[e._v("成员列表")])],1),1==e.activePage?t("el-row",[t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:s(6090)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("创建日期")]),t("p",[e._v(" "+e._s(e.form.date))])])])]),t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:s(1744)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("人数")]),t("p",[e._v(" "+e._s(e.form.count))])])])]),t("div",{staticClass:"container"},[t("div",{staticClass:"card"},[t("div",{staticClass:"image"},[t("img",{attrs:{href:"#",src:s(7314)}})]),t("div",{staticClass:"content"},[t("h3",[e._v("简介")]),t("p",[e._v(" "+e._s(e.form.desc))])])])])]):e._e(),2==e.activePage?t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projectTitle"},[t("i",{staticClass:"el-icon-s-order"}),t("span",{staticClass:"membersTitle"},[e._v("项目")]),t("el-button",{staticClass:"addButton",attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){e.dialogVisible=!0}}}),t("el-dialog",{attrs:{title:"创建项目",visible:e.dialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.project,"label-width":"auto"}},[t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{model:{value:e.project.name,callback:function(t){e.$set(e.project,"name",t)},expression:"project.name"}})],1),t("el-form-item",{attrs:{label:"项目简介"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2},autocomplete:"off",resize:"none"},model:{value:e.project.desc,callback:function(t){e.$set(e.project,"desc",t)},expression:"project.desc"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancelChanges}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.createProject}},[e._v("确定")])],1)],1),t("el-button",{staticClass:"recycleButton",attrs:{icon:"el-icon-delete-solid",round:""},on:{click:e.toRecycle}},[e._v("回收站")]),e.haveProject&&2==e.activePage?t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.projectList.filter((t=>!e.search||t.title.toLowerCase().includes(e.search.toLowerCase())||t.creatorName.toLowerCase().includes(e.search.toLowerCase()))),"cell-class-name":e.getCellIndex},on:{"cell-click":e.toProject}},[t("el-table-column",{attrs:{label:"项目名字",prop:"title",sortable:""}}),t("el-table-column",{attrs:{label:"创建日期",prop:"createdAt",sortable:""}}),t("el-table-column",{attrs:{label:"创建者",prop:"creatorName"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制",placement:"top"}},[t("el-button",{attrs:{size:"mini",icon:"el-icon-document-copy",circle:""},on:{click:function(t){return e.duplicateProject(s.$index,s.row)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[t("el-button",{staticClass:"deleteButton",attrs:{size:"mini",type:"danger",icon:"el-icon-folder-delete",circle:""},on:{click:function(t){return e.deleteProject(s.$index,s.row)}}})],1)]}}],null,!1,2904264602)},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入您的搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],2)],1):e._e()],1)])],1):e._e(),e.haveProject||2!=e.activePage?e._e():t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"projects"},[e._v(" 暂无项目！ ")])])],1),3==e.activePage?t("el-row",[t("Doc")],1):e._e(),4==e.activePage?t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"members"},[t("i",{staticClass:"el-icon-user-solid"}),t("span",{staticClass:"membersTitle"},[e._v("成员列表")])])])],1):e._e(),4==e.activePage?t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"membersRow"},e._l(e.membersList,(function(s){return t("el-descriptions",{key:s.id,staticClass:"description",attrs:{border:"",column:5}},[t("el-descriptions-item",{attrs:{label:"昵称","label-class-name":e.my-e.label,contentStyle:e.contentStyle,labelStyle:e.labelStyle}},[e._v(e._s(s.username))]),""==s.realname?t("el-descriptions-item",{attrs:{label:"真实姓名",contentStyle:e.contentStyle,labelStyle:e.labelStyle}},[e._v(e._s(s.username))]):t("el-descriptions-item",{attrs:{label:"真实姓名",contentStyle:e.contentStyle,labelStyle:e.labelStyle}},[e._v(e._s(s.realname))]),t("el-descriptions-item",{attrs:{label:"邮箱",contentStyle:e.contentStyle2,labelStyle:e.labelStyle}},[e._v(e._s(s.email))]),t("el-descriptions-item",{attrs:{label:"身份",labelStyle:e.labelStyle}},["Main Admin"==s.position?t("el-tag",{attrs:{size:"small",type:"warning"}},[e._v("主管理员")]):e._e(),"Admin"==s.position?t("el-tag",{attrs:{size:"small"}},[e._v("管理员")]):e._e(),"Member"==s.position?t("el-tag",{attrs:{size:"small",type:"info"}},[e._v("成员")]):e._e(),t("el-dropdown",{staticClass:"More"},[e.checkPosition4(s.id)?t("i",{staticClass:"el-icon-more"}):e._e(),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.checkPosition(s.position)?t("el-dropdown-item",{on:{click:function(t){return e.promoteMember(s.id)}}},[e._v("升为管理员")]):e._e(),e.checkPosition3(s.position)?t("el-dropdown-item",{on:{click:function(t){return e.demoteMember(s.id)}}},[e._v("降为成员")]):e._e(),e.checkPosition2(s.position)?t("el-dropdown-item",{on:{click:function(t){return e.kickMember(s.id)}}},[e._v("移除")]):e._e()],1)],1)],1)],1)})),1)])],1):e._e()],1)])],1)},o=[],a=s(4209),l=s(837),r=s(2094),n={name:"Team",components:{Navi:a.Z,Doc:l.Z},data(){return{haveTeam:!1,dialogVisible:!1,dialogVisible2:!1,isMainAdmin:!1,isAdmin:!1,isMember:!1,userId:"",activeIndex:"1",activePage:1,form:{name:"",desc:"",date:"",count:""},project:{name:"",desc:""},inviteName:"",haveProject:!1,projectList:[],membersList:[],search:"",rowIndex:0,cellIndex:0,contentStyle:{width:"200px"},contentStyle2:{width:"300px"},labelStyle:{width:"100px"}}},created(){var e;this.getTeamInfo(),this.getProjectDetail(),e=r.Z.getters.getUser(r.Z.state()),e&&(this.userId=e.user.id)},methods:{duplicateProject(e,t){console.log(e,t);var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/copy/"+t.id,headers:s}).then((e=>{console.log(e),this.$message.success("项目复制成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("项目复制失败！")}))},deleteProject(e,t){console.log(e,t),console.log(e);var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/project/"+t.id,headers:s}).then((t=>{console.log(t),this.$message.success("项目删除成功！"),this.projectList.splice(e,1)})).catch((e=>{console.log(e),this.$message.warning("项目删除失败！")}))},cancelChanges(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},handleClose(){this.dialogVisible=!1,this.project.name="",this.project.desc=""},cancelChanges2(){this.dialogVisible2=!1,this.inviteName=""},handleClose2(){this.dialogVisible2=!1,this.inviteName=""},handleSelect(e,t){"1"==e&&(this.activePage=1),"2"==e&&(this.activePage=2),"3"==e&&(this.activePage=3),"4"==e&&(this.activePage=4)},createProject(){if(""==this.project.name)return void this.$message.warning("项目名不可为空！");if(""==this.project.desc)return void this.$message.warning("项目简介不可为空！");const e=new FormData;e.append("title",this.project.name),e.append("description",this.project.desc);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/project/create/"+this.$route.params.id,data:e,headers:t}).then((e=>{console.log(e),this.$message.success("创建项目成功"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e),this.$message.warning("创建项目失败")})),this.dialogVisible=!1},enterProject(e){this.$router.push("/project/"+e)},getCellIndex({row:e,column:t,rowIndex:s,columnIndex:i}){e.index=s,t.index=i},toProject(e,t,s,i){this.rowIndex=e.index,this.columnIndex=t.index,3!=this.columnIndex&&this.$router.push("/project/"+e.id)},inviteMember(){const e=new FormData;e.append("user",this.inviteName),e.append("teamId",this.$route.params.id);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/team/invite",data:e,headers:t}).then((e=>{console.log(e),this.$message.success("邀请成功"),this.dialogVisible2=!1})).catch((e=>{console.log(e),this.$message.warning("抱歉，邀请失败！")}))},leaveTeam(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/leave/"+this.$route.params.id,headers:e}).then((e=>{console.log(e),this.$message.success("离开团队成功"),this.$router.push({path:"/team/&"})})).catch((e=>{console.log(e),this.$message.warning("您是主管理员，无法离开！")}))},async getTeamInfo(){await this.$axios.all([this.getTeamDetail(),this.getTeamMembers()]).then(this.$axios.spread(((e,t)=>{console.log(e),console.log(t),this.form.name=e.data.teamName,this.form.desc=e.data.description,this.form.count=e.data.members,this.form.date=e.data.createdAt.slice(0,10),this.membersList=t.data.results;for(let s=0;s<this.membersList.length;s++)if(this.membersList[s].id===this.userId){if(0==this.membersList[s].position){this.isMainAdmin=!0,console.log("MAIN");break}if(1==this.membersList[s].position){this.isAdmin=!0,console.log("ADMIN");break}if(2==this.membersList[s].position){this.isMember=!0,console.log("NORMAL");break}}for(let s=0;s<this.membersList.length;s++)0==this.membersList[s].position&&(this.membersList[s].position="Main Admin"),1==this.membersList[s].position&&(this.membersList[s].position="Admin"),2==this.membersList[s].position&&(this.membersList[s].position="Member")}))).catch((e=>{console.log(e),this.$router.push({path:"/"})}))},getTeamMembers(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/member/list/"+this.$route.params.id,headers:e})},getTeamDetail(){var e={};return localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/team/"+this.$route.params.id,headers:e})},getProjectDetail(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/project/list?belongTo="+this.$route.params.id,headers:e}).then((e=>{console.log(e),this.projectList=e.data.results;for(let t=0;t<this.projectList.length;t++)this.projectList[t].createdAt=this.projectList[t].createdAt.slice(0,10);this.projectList.length>0&&(this.haveProject=!0)})).catch((e=>{console.log(e)}))},hasChinese(){const e=/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/,t=this.form.desc.match(e);return t?(console.log("true"),!0):(console.log("false"),!1)},checkPosition(e){return!("Member"!==e||!this.isMainAdmin&&!this.isAdmin)&&(console.log("CAN PROMOTE"),!0)},checkPosition2(e){return"Member"===e&&(this.isMainAdmin||this.isAdmin)?(console.log("CAN DEMOTE"),!0):!("Admin"!==e||!this.isMainAdmin)&&(console.log("CAN KICK"),!0)},checkPosition3(e){return!(!this.isMainAdmin||"Admin"!==e)&&(console.log("CAN DEMOTE"),!0)},checkPosition4(e){return e!=this.userId&&!(!this.isMainAdmin&&!this.isAdmin)},promoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/set/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},demoteMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"put",url:"/api/v1/team/admin/remove/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("设置成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},kickMember(e){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/team/member/remove/"+this.$route.params.id+"/"+e,headers:t}).then((e=>{console.log(e),this.$message.success("移除成功！"),setTimeout((function(){location.reload(!0)}),500)})).catch((e=>{console.log(e)}))},toRecycle(){this.$router.push("/recycle/"+this.$route.params.id)}}},c=n,m=s(1001),d=(0,m.Z)(c,i,o,!1,null,"147d01c4",null),h=d.exports},6090:function(e,t,s){e.exports=s.p+"img/Group1.92a5a959.png"},1744:function(e,t,s){e.exports=s.p+"img/Group2.d3fdbfc4.png"},7314:function(e,t,s){e.exports=s.p+"img/Group3.f60b8a60.png"}}]);
//# sourceMappingURL=767.aa70e1ca.js.map